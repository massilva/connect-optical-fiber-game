!function(t){"use strict";function e(t){t.select("svg").remove()}function r(){return d3.select(".content").style({width:w.width+"px"})}function a(){var t,a;return t=r(),e(t),a=t.append("svg"),a.attr("width",w.width+"px"),a.classed("h100",!0),a}function c(){g+=1}function i(){x>g&&(c(),p(g))}function o(t,e,r){var c=a();c.append("text").text("You hit(s)").attr("x",.5*w.width).attr("y",150).attr("font-size","5em").attr("fill","#2980b9").attr("text-anchor","middle"),c.append("text").attr("text-anchor","middle").attr("x",.5*w.width).attr("y",320).text(e+" of "+r+".").attr("font-size","10em").attr("fill","red"),c.append("text").attr("class","btn").attr("text-anchor","middle").attr("x",.5*w.width).attr("y",450).text("Restart").attr("font-size","5em").attr("fill","#2980b9").on("click",function(){c.selectAll("text").remove(),m(c,t,r)})}function n(t,e,r){var a,c=0;for(a=0;a<e.length;a+=1)t[a]===e[a]&&(c+=1);c===r?i():o(t,c,r)}function s(t){var e,r,a,c=[];for(a=t.length-1;a>=0;a-=1)c[a]=t[a];for(a=c.length-1;a>=0;a-=1)e=Math.floor(Math.random()*a),r=c[a],c[a]=c[e],c[e]=r;return c}function l(t){return"line-"+t}function d(t,e,r){var a={source:[],target:[]};return a.source=t.enter().append("g").attr({transform:r.transform,"class":"fibreSource"}),a.source.append("rect").attr({width:r.objectsDim.width,height:r.objectsDim.height,fill:function(t,e){return r.colors[e]},opacity:.75}),a.target=e.enter().append("g").attr({transform:r.transform,"class":"fibreTarget"}),a.target.append("rect").attr({width:r.objectsDim.width,height:r.objectsDim.height,fill:r.defaultColor}),a}function f(t,e){var r,a;for(a={source:[],target:[]},r=0;t>r;r+=1)a.source.push({x:10,y:e.objectsDim.height*r+10*(r+1)}),a.target.push({x:e.width-e.objectsDim.width-10,y:e.objectsDim.height*r+10*(r+1)});return a}function u(){p(g)}function h(){g=0,u()}var g,p,m,x=5,b=t.screen.availWidth,w={width:.8*b,objectsDim:{width:50,height:50},transform:function(t){return"translate("+[t.x,t.y]+")"},colors:["#2ecc71","#f1c40f","#16a085","#c0392b","#8e44ad","#2c3e50","#d35400"],defaultColor:"#bdc3c7"};m=function(t,e,r){var a,c,i,o={},s=[],u=0,h={x:w.objectsDim.width/2,y:w.objectsDim.height/2},g=function(e,r){t.insert("line",":first-child").attr("x1",h.x+e.d.x).attr("y1",h.y+e.d.y).attr("x2",h.x+r.x).attr("y2",h.y+r.y).attr("stroke-width",5).attr("stroke","black").attr("id",l(e.i))};o=f(r,w),c=t.selectAll("g.fibre").data(o.source),a=t.selectAll("g.fibre").data(o.target),d(c,a,w),d3.selectAll(".fibreSource rect").on("click",function(t,e){var r=this.parentNode;d3.select(r).classed("selected",!0),i={d:t,i:e}}),d3.selectAll(".fibreTarget rect").on("click",function(t,c){var o;i&&(o=d3.selectAll('g[data-source="'+i.i+'"]'),a=this.parentNode,a.parentNode.appendChild(a),a=d3.select(a),a.attr("data-source")||(o.attr("data-source","").classed("selected",!1),o.select("rect").attr("fill",w.defaultColor),d3.selectAll("#"+l(i.i)).remove(),a.classed("selected",!0),a.attr("data-source",i.i),a.select("rect").attr("fill",w.colors[i.i]),s[i.i]=c,g(i,t),u+=1,u===r&&n(e,s,r)))})},p=function(t){var e,r,c=t+2,i={};for(i={source:[],target:[]},e=0;c>e;e+=1)i.source[e]=e;i.target=s(i.source),r=a(),m(r,i.target,c)},h()}(window);
