!function(t){"use strict";function e(t){t.select("svg").remove()}function r(){return d3.select(".content").style({width:x.width+"px"})}function i(){var t,i;return t=r(),e(t),i=t.append("svg"),i.attr("width",x.width+"px"),i.classed("h100",!0),i}function c(){m+=1,b(m)}function a(t,e,r,i,c,a){return t.append("text").text(i).attr("x",e).attr("y",r).attr("font-size",c||"10em").attr("fill",a||"#2980b9").attr("text-anchor","middle")}function n(){var t,e=i();a(e,.5*x.width,250,"Stage "+m+" complete","7em"),t=a(e,.5*x.width,400,"Next","5em","#27ae60"),t.attr("class","btn").on("click",function(){p>m?c():a(e,.5*x.width,350,"Congrats! finished game")})}function o(t,e,r){var c,n=i();a(n,.5*x.width,150,"You hit(s)","5em"),a(n,.5*x.width,350,e+" of "+r,"10em","red"),c=a(n,.5*x.width,450,"Restart","5em"),c.attr("class","btn").on("click",function(){n.selectAll("text").remove(),w(n,t,r)})}function s(t,e,r){var i,c=0;for(i=0;i<e.length;i+=1)t[i]===e[i]&&(c+=1);c===r?n():o(t,c,r)}function l(t){var e,r,i,c=[];for(i=t.length-1;i>=0;i-=1)c[i]=t[i];for(i=c.length-1;i>=0;i-=1)e=Math.floor(Math.random()*i),r=c[i],c[i]=c[e],c[e]=r;return c}function d(t){return"line-"+t}function f(t,e,r){var i={source:[],target:[]};return i.source=t.enter().append("g").attr({transform:r.transform,"class":"fibreSource"}),i.source.append("rect").attr({width:r.objectsDim.width,height:r.objectsDim.height,fill:function(t,e){return r.colors[e]},opacity:.75}),i.target=e.enter().append("g").attr({transform:r.transform,"class":"fibreTarget"}),i.target.append("rect").attr({width:r.objectsDim.width,height:r.objectsDim.height,fill:r.defaultColor}),i}function h(t,e){var r,i;for(i={source:[],target:[]},r=0;t>r;r+=1)i.source.push({x:10,y:e.objectsDim.height*r+10*(r+1)}),i.target.push({x:e.width-e.objectsDim.width-10,y:e.objectsDim.height*r+10*(r+1)});return i}function u(){var t,e,r,c=i(),n=["Your internet is connected via optical fiber cable.","The internet crashed and you need to merge the fibers ","in the splice distributor to make it work.","Connect the fibres, left side with right side,","correctly to fix it."];for(e=150,t=0;t<n.length;t+=1)a(c,.5*x.width,e+40*t,n[t],"3em").attr("stroke","none");r=a(c,.5*x.width,400,"Start Game","5em","#27ae60"),r.attr("class","btn").on("click",function(){b(m)})}function g(){m=0,u()}var m,b,w,p=5,v=t.screen.availWidth,x={width:.8*v,objectsDim:{width:50,height:50},transform:function(t){return"translate("+[t.x,t.y]+")"},colors:["#2ecc71","#f1c40f","#16a085","#c0392b","#8e44ad","#2c3e50","#d35400"],defaultColor:"#bdc3c7"};w=function(t,e,r){var i,c,a,n={},o=[],l=0,u={x:x.objectsDim.width/2,y:x.objectsDim.height/2},g=function(e,r){t.insert("line",":first-child").attr("x1",u.x+e.d.x).attr("y1",u.y+e.d.y).attr("x2",u.x+r.x).attr("y2",u.y+r.y).attr("stroke-width",5).attr("stroke","black").attr("id",d(e.i))};n=h(r,x),c=t.selectAll("g.fibre").data(n.source),i=t.selectAll("g.fibre").data(n.target),f(c,i,x),d3.selectAll(".fibreSource rect").on("click",function(t,e){var r=this.parentNode;d3.select(r).classed("selected",!0),a={d:t,i:e}}),d3.selectAll(".fibreTarget rect").on("click",function(t,c){var n;a&&(n=d3.selectAll('g[data-source="'+a.i+'"]'),i=this.parentNode,i.parentNode.appendChild(i),i=d3.select(i),i.attr("data-source")||(n.attr("data-source","").classed("selected",!1),n.select("rect").attr("fill",x.defaultColor),d3.selectAll("#"+d(a.i)).remove(),i.classed("selected",!0),i.attr("data-source",a.i),i.select("rect").attr("fill",x.colors[a.i]),o[a.i]=c,g(a,t),l+=1,l===r&&s(e,o,r)))})},b=function(t){var e,r,c=t+2,a={};for(a={source:[],target:[]},e=0;c>e;e+=1)a.source[e]=e;a.target=l(a.source),r=i(),w(r,a.target,c)},g()}(window);
